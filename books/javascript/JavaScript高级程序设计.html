<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 高级程序设计(第 4 版) | vue-run</title>
    <meta name="description" content="打造一个舒适的前端工作流">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.31620747.css" as="style"><link rel="preload" href="/assets/js/app.ad74b50b.js" as="script"><link rel="preload" href="/assets/js/2.2054c3ab.js" as="script"><link rel="preload" href="/assets/js/22.afbc471c.js" as="script"><link rel="prefetch" href="/assets/js/10.2fcb329f.js"><link rel="prefetch" href="/assets/js/11.aa231dd9.js"><link rel="prefetch" href="/assets/js/12.9f1fdf0e.js"><link rel="prefetch" href="/assets/js/13.d119215d.js"><link rel="prefetch" href="/assets/js/14.de9dfb60.js"><link rel="prefetch" href="/assets/js/15.15c1321a.js"><link rel="prefetch" href="/assets/js/16.d047a64e.js"><link rel="prefetch" href="/assets/js/17.fa9b699d.js"><link rel="prefetch" href="/assets/js/18.d4110752.js"><link rel="prefetch" href="/assets/js/19.e47e31ff.js"><link rel="prefetch" href="/assets/js/20.c21ff74b.js"><link rel="prefetch" href="/assets/js/21.403ef4cb.js"><link rel="prefetch" href="/assets/js/23.8fc68b7a.js"><link rel="prefetch" href="/assets/js/24.aaa61bbc.js"><link rel="prefetch" href="/assets/js/25.1546e7a8.js"><link rel="prefetch" href="/assets/js/26.d61179ba.js"><link rel="prefetch" href="/assets/js/27.357b1395.js"><link rel="prefetch" href="/assets/js/28.cc219ae3.js"><link rel="prefetch" href="/assets/js/29.b6955861.js"><link rel="prefetch" href="/assets/js/3.a4e279d6.js"><link rel="prefetch" href="/assets/js/30.043e4801.js"><link rel="prefetch" href="/assets/js/31.c1b8cf35.js"><link rel="prefetch" href="/assets/js/32.42958bd6.js"><link rel="prefetch" href="/assets/js/33.e126e05f.js"><link rel="prefetch" href="/assets/js/34.6864e25a.js"><link rel="prefetch" href="/assets/js/35.aeeec13a.js"><link rel="prefetch" href="/assets/js/36.a3946cf6.js"><link rel="prefetch" href="/assets/js/37.b4478e59.js"><link rel="prefetch" href="/assets/js/38.574146f4.js"><link rel="prefetch" href="/assets/js/39.3cd37280.js"><link rel="prefetch" href="/assets/js/4.c0861a31.js"><link rel="prefetch" href="/assets/js/40.c5a34540.js"><link rel="prefetch" href="/assets/js/41.7f323d85.js"><link rel="prefetch" href="/assets/js/42.d31181fa.js"><link rel="prefetch" href="/assets/js/43.6e0bf2e6.js"><link rel="prefetch" href="/assets/js/44.68a308ee.js"><link rel="prefetch" href="/assets/js/45.2ef9d7c8.js"><link rel="prefetch" href="/assets/js/46.5441fd11.js"><link rel="prefetch" href="/assets/js/47.fab1189a.js"><link rel="prefetch" href="/assets/js/48.ff364c5c.js"><link rel="prefetch" href="/assets/js/49.25efaf4d.js"><link rel="prefetch" href="/assets/js/5.a116802f.js"><link rel="prefetch" href="/assets/js/50.ec8ad626.js"><link rel="prefetch" href="/assets/js/51.d1f171f3.js"><link rel="prefetch" href="/assets/js/52.100e2510.js"><link rel="prefetch" href="/assets/js/53.f7e297ba.js"><link rel="prefetch" href="/assets/js/54.d0716ad6.js"><link rel="prefetch" href="/assets/js/55.6984554f.js"><link rel="prefetch" href="/assets/js/56.c9d4b98a.js"><link rel="prefetch" href="/assets/js/57.1736acb1.js"><link rel="prefetch" href="/assets/js/58.1e194851.js"><link rel="prefetch" href="/assets/js/59.cc8df9af.js"><link rel="prefetch" href="/assets/js/6.f95efe2a.js"><link rel="prefetch" href="/assets/js/60.6a846f1a.js"><link rel="prefetch" href="/assets/js/61.e0a08076.js"><link rel="prefetch" href="/assets/js/62.5b3128e3.js"><link rel="prefetch" href="/assets/js/63.d9c80c61.js"><link rel="prefetch" href="/assets/js/64.686b1cb0.js"><link rel="prefetch" href="/assets/js/65.ce207947.js"><link rel="prefetch" href="/assets/js/66.cea7a33b.js"><link rel="prefetch" href="/assets/js/67.6bf9f16e.js"><link rel="prefetch" href="/assets/js/68.c3755fba.js"><link rel="prefetch" href="/assets/js/69.1987d1f9.js"><link rel="prefetch" href="/assets/js/7.60e754f0.js"><link rel="prefetch" href="/assets/js/70.55bd8888.js"><link rel="prefetch" href="/assets/js/71.3f35de42.js"><link rel="prefetch" href="/assets/js/72.249f0def.js"><link rel="prefetch" href="/assets/js/73.e19ee3e7.js"><link rel="prefetch" href="/assets/js/8.d7e7dd67.js"><link rel="prefetch" href="/assets/js/9.b3d60b51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.31620747.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">vue-run</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  推荐配置
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Javascript书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/javascript/编写高质量JavaScript的68个有效方法.html" class="nav-link">
  编写高质量JavaScript的68个有效方法
</a></li><li class="dropdown-subitem"><a href="/books/javascript/编写可维护的JavaScript.html" class="nav-link">
  编写可维护的JavaScript
</a></li><li class="dropdown-subitem"><a href="/books/javascript/你不知道的JavaScript上卷.html" class="nav-link">
  你不知道的JavaScript(上卷)
</a></li><li class="dropdown-subitem"><a href="/books/javascript/你不知道的JavaScript中卷.html" class="nav-link">
  你不知道的JavaScript(中卷)
</a></li><li class="dropdown-subitem"><a href="/books/javascript/ES6标准入门.html" class="nav-link">
  ES6标准入门
</a></li><li class="dropdown-subitem"><a href="/books/javascript/深入理解ES6.html" class="nav-link">
  深入理解ES6
</a></li><li class="dropdown-subitem"><a href="/books/javascript/深入理解TypeScript.html" class="nav-link">
  深入理解TypeScript
</a></li><li class="dropdown-subitem"><a href="/books/javascript/深入浅出Vue.js.html" class="nav-link">
  深入浅出Vue.js
</a></li><li class="dropdown-subitem"><a href="/books/javascript/了不起的JavaScript工程师.html" class="nav-link">
  了不起的JavaScript工程师
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript高级程序设计.html" class="nav-link">
  JavaScript高级程序设计
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript面向对象编程指南.html" class="nav-link">
  JavaScript面向对象编程指南
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript面向对象精要.html" class="nav-link">
  JavaScript面向对象精要
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript函数式编程指南.html" class="nav-link">
  JavaScript函数式编程指南
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript忍者秘籍.html" class="nav-link">
  JavaScript忍者秘籍
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript编程精解.html" class="nav-link">
  JavaScript编程精解
</a></li><li class="dropdown-subitem"><a href="/books/javascript/Javascript语言精髓与编程实践.html" class="nav-link">
  JavaScript语言精髓与编程实践
</a></li><li class="dropdown-subitem"><a href="/books/javascript/Javascript设计模式与开发实战.html" class="nav-link">
  JavaScript设计模式与开发实战
</a></li><li class="dropdown-subitem"><a href="/books/javascript/Javascript框架设计.html" class="nav-link">
  JavaScript框架设计
</a></li></ul></li><li class="dropdown-item"><h4>
          Node书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/node/Node.js实战.html" class="nav-link">
  Node.js实战
</a></li><li class="dropdown-subitem"><a href="/books/node/Node.js开发实战.html" class="nav-link">
  Node.js开发实战
</a></li><li class="dropdown-subitem"><a href="/books/node/Node.js设计模式.html" class="nav-link">
  Node.js设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          算法书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/algorithmic/学习JavaScript数据结构与算法.html" class="nav-link">
  学习JavaScript数据结构与算法
</a></li></ul></li><li class="dropdown-item"><h4>
          css书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/css/css揭秘.html" class="nav-link">
  CSS揭秘
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><span class="title">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/interview/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/interview/HTTP.html" class="nav-link">
  HTTP
</a></li></ul></li><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/设计模式.html" class="nav-link">
  设计模式
</a></li><li class="dropdown-subitem"><a href="/interview/Node.html" class="nav-link">
  Node
</a></li><li class="dropdown-subitem"><a href="/interview/算法.html" class="nav-link">
  算法
</a></li><li class="dropdown-subitem"><a href="/interview/兼容性.html" class="nav-link">
  兼容性
</a></li><li class="dropdown-subitem"><a href="/interview/缓存.html" class="nav-link">
  缓存
</a></li><li class="dropdown-subitem"><a href="/interview/性能优化.html" class="nav-link">
  性能优化
</a></li></ul></li><li class="dropdown-item"><h4>
          RunTime
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/浏览器.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-subitem"><a href="/interview/Webpack.html" class="nav-link">
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          选型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/interview/React.html" class="nav-link">
  React
</a></li></ul></li><li class="dropdown-item"><h4>
          能力周边
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/Git操作.html" class="nav-link">
  Git操作
</a></li><li class="dropdown-subitem"><a href="/interview/前端监控.html" class="nav-link">
  前端监控
</a></li><li class="dropdown-subitem"><a href="/interview/安全防范.html" class="nav-link">
  安全防范
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/practice/" class="nav-link">
  最佳实践
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  只言片语
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  推荐配置
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Javascript书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/javascript/编写高质量JavaScript的68个有效方法.html" class="nav-link">
  编写高质量JavaScript的68个有效方法
</a></li><li class="dropdown-subitem"><a href="/books/javascript/编写可维护的JavaScript.html" class="nav-link">
  编写可维护的JavaScript
</a></li><li class="dropdown-subitem"><a href="/books/javascript/你不知道的JavaScript上卷.html" class="nav-link">
  你不知道的JavaScript(上卷)
</a></li><li class="dropdown-subitem"><a href="/books/javascript/你不知道的JavaScript中卷.html" class="nav-link">
  你不知道的JavaScript(中卷)
</a></li><li class="dropdown-subitem"><a href="/books/javascript/ES6标准入门.html" class="nav-link">
  ES6标准入门
</a></li><li class="dropdown-subitem"><a href="/books/javascript/深入理解ES6.html" class="nav-link">
  深入理解ES6
</a></li><li class="dropdown-subitem"><a href="/books/javascript/深入理解TypeScript.html" class="nav-link">
  深入理解TypeScript
</a></li><li class="dropdown-subitem"><a href="/books/javascript/深入浅出Vue.js.html" class="nav-link">
  深入浅出Vue.js
</a></li><li class="dropdown-subitem"><a href="/books/javascript/了不起的JavaScript工程师.html" class="nav-link">
  了不起的JavaScript工程师
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript高级程序设计.html" class="nav-link">
  JavaScript高级程序设计
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript面向对象编程指南.html" class="nav-link">
  JavaScript面向对象编程指南
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript面向对象精要.html" class="nav-link">
  JavaScript面向对象精要
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript函数式编程指南.html" class="nav-link">
  JavaScript函数式编程指南
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript忍者秘籍.html" class="nav-link">
  JavaScript忍者秘籍
</a></li><li class="dropdown-subitem"><a href="/books/javascript/JavaScript编程精解.html" class="nav-link">
  JavaScript编程精解
</a></li><li class="dropdown-subitem"><a href="/books/javascript/Javascript语言精髓与编程实践.html" class="nav-link">
  JavaScript语言精髓与编程实践
</a></li><li class="dropdown-subitem"><a href="/books/javascript/Javascript设计模式与开发实战.html" class="nav-link">
  JavaScript设计模式与开发实战
</a></li><li class="dropdown-subitem"><a href="/books/javascript/Javascript框架设计.html" class="nav-link">
  JavaScript框架设计
</a></li></ul></li><li class="dropdown-item"><h4>
          Node书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/node/Node.js实战.html" class="nav-link">
  Node.js实战
</a></li><li class="dropdown-subitem"><a href="/books/node/Node.js开发实战.html" class="nav-link">
  Node.js开发实战
</a></li><li class="dropdown-subitem"><a href="/books/node/Node.js设计模式.html" class="nav-link">
  Node.js设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          算法书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/algorithmic/学习JavaScript数据结构与算法.html" class="nav-link">
  学习JavaScript数据结构与算法
</a></li></ul></li><li class="dropdown-item"><h4>
          css书籍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/css/css揭秘.html" class="nav-link">
  CSS揭秘
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><span class="title">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/JavaScript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/interview/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/interview/HTTP.html" class="nav-link">
  HTTP
</a></li></ul></li><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/设计模式.html" class="nav-link">
  设计模式
</a></li><li class="dropdown-subitem"><a href="/interview/Node.html" class="nav-link">
  Node
</a></li><li class="dropdown-subitem"><a href="/interview/算法.html" class="nav-link">
  算法
</a></li><li class="dropdown-subitem"><a href="/interview/兼容性.html" class="nav-link">
  兼容性
</a></li><li class="dropdown-subitem"><a href="/interview/缓存.html" class="nav-link">
  缓存
</a></li><li class="dropdown-subitem"><a href="/interview/性能优化.html" class="nav-link">
  性能优化
</a></li></ul></li><li class="dropdown-item"><h4>
          RunTime
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/浏览器.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-subitem"><a href="/interview/Webpack.html" class="nav-link">
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          选型
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/interview/React.html" class="nav-link">
  React
</a></li></ul></li><li class="dropdown-item"><h4>
          能力周边
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/Git操作.html" class="nav-link">
  Git操作
</a></li><li class="dropdown-subitem"><a href="/interview/前端监控.html" class="nav-link">
  前端监控
</a></li><li class="dropdown-subitem"><a href="/interview/安全防范.html" class="nav-link">
  安全防范
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/practice/" class="nav-link">
  最佳实践
</a></div><div class="nav-item"><a href="/summary/" class="nav-link">
  只言片语
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript 高级程序设计(第 4 版)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第1章-什么是javascript" class="sidebar-link">第1章 什么是JavaScript</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第2章-html中的javascript" class="sidebar-link">第2章 HTML中的JavaScript</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第3章-语法" class="sidebar-link">第3章 语法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第4章-变量、作用域与内存" class="sidebar-link">第4章 变量、作用域与内存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_4-1-原始值与引用值" class="sidebar-link">4.1 原始值与引用值</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_4-2-执行上下文与作用域" class="sidebar-link">4.2 执行上下文与作用域</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_4-3-垃圾回收" class="sidebar-link">4.3 垃圾回收</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_4-4-小结" class="sidebar-link">4.4 小结</a></li></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第5章-基本引用类型" class="sidebar-link">第5章 基本引用类型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第6章-集合引用类型" class="sidebar-link">第6章 集合引用类型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第7章-迭代器与生成器" class="sidebar-link">第7章 迭代器与生成器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第8章-对象、类与面向对象编程" class="sidebar-link">第8章 对象、类与面向对象编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_8-1-理解对象" class="sidebar-link">8.1 理解对象</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_8-2-创建对象" class="sidebar-link">8.2 创建对象</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_8-3-继承" class="sidebar-link">8.3 继承</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_8-4-类" class="sidebar-link">8.4 类</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_8-5-小结" class="sidebar-link">8.5 小结</a></li></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第9章-代理与反射" class="sidebar-link">第9章 代理与反射</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第10章-函数" class="sidebar-link">第10章 函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-1箭头函数" class="sidebar-link">10.1箭头函数</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-2-函数名" class="sidebar-link">10.2 函数名</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-3-理解参数" class="sidebar-link">10.3 理解参数</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-4-没有重载" class="sidebar-link">10.4 没有重载</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-5-默认参数值" class="sidebar-link">10.5 默认参数值</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-6-参数扩展与收集" class="sidebar-link">10.6 参数扩展与收集</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-7-函数声明与函数表达式" class="sidebar-link">10.7 函数声明与函数表达式</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-8-函数作为值" class="sidebar-link">10.8 函数作为值</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-9-函数内部" class="sidebar-link">10.9 函数内部</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-10-函数属性与方法" class="sidebar-link">10.10 函数属性与方法</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-11-函数表达式" class="sidebar-link">10.11 函数表达式</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-12-递归" class="sidebar-link">10.12 递归</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-13-尾调用优化" class="sidebar-link">10.13 尾调用优化</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-14-闭包" class="sidebar-link">10.14 闭包</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-15-立即调用的函数表达式" class="sidebar-link">10.15 立即调用的函数表达式</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-16-私有变量" class="sidebar-link">10.16 私有变量</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_10-17-小结" class="sidebar-link">10.17 小结</a></li></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第11章-期约与异步函数" class="sidebar-link">第11章 期约与异步函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_11-1-异步编程" class="sidebar-link">11.1 异步编程</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_11-2-期约promise" class="sidebar-link">11.2 期约Promise</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_11-3-异步函数" class="sidebar-link">11.3 异步函数</a></li><li class="sidebar-sub-header"><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#_11-4-小结" class="sidebar-link">11.4 小结</a></li></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第12章-bom" class="sidebar-link">第12章 BOM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第13章-客户端检测" class="sidebar-link">第13章 客户端检测</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第14章-dom" class="sidebar-link">第14章 DOM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第15章-dom扩展" class="sidebar-link">第15章 DOM扩展</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第16章-dom2和dom3" class="sidebar-link">第16章 DOM2和DOM3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第17章-事件" class="sidebar-link">第17章 事件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第18章-动画与canvas图形" class="sidebar-link">第18章 动画与Canvas图形</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第19章-表单脚本" class="sidebar-link">第19章 表单脚本</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第20章-javascript-api" class="sidebar-link">第20章 JavaScript API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第21章-错误处理与调试" class="sidebar-link">第21章 错误处理与调试</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第22章-处理xml" class="sidebar-link">第22章 处理XML</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第23章-json" class="sidebar-link">第23章 JSON</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第24章-网络请求与远程资源" class="sidebar-link">第24章 网络请求与远程资源</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第25章-客户端存储" class="sidebar-link">第25章 客户端存储</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第26章-模块" class="sidebar-link">第26章 模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第27章-工作者线程" class="sidebar-link">第27章 工作者线程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/books/javascript/JavaScript%E9%AB%98%E7%BA%A7%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.html#第28章-最佳实践" class="sidebar-link">第28章 最佳实践</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-高级程序设计-第-4-版"><a href="#javascript-高级程序设计-第-4-版" class="header-anchor">#</a> JavaScript 高级程序设计(第 4 版)</h1> <p><img src="/assets/img/j7.253ce779.jpg" alt="JavaScript 高级程序设计"></p><div class="table-of-contents"><ul><li><a href="#第1章-什么是javascript">第1章 什么是JavaScript</a></li><li><a href="#第2章-html中的javascript">第2章 HTML中的JavaScript</a></li><li><a href="#第3章-语法">第3章 语法</a></li><li><a href="#第4章-变量、作用域与内存">第4章 变量、作用域与内存</a><ul><li><a href="#_4-1-原始值与引用值">4.1 原始值与引用值</a></li><li><a href="#_4-2-执行上下文与作用域">4.2 执行上下文与作用域</a></li><li><a href="#_4-3-垃圾回收">4.3 垃圾回收</a></li><li><a href="#_4-4-小结">4.4 小结</a></li></ul></li><li><a href="#第5章-基本引用类型">第5章 基本引用类型</a></li><li><a href="#第6章-集合引用类型">第6章 集合引用类型</a></li><li><a href="#第7章-迭代器与生成器">第7章 迭代器与生成器</a></li><li><a href="#第8章-对象、类与面向对象编程">第8章 对象、类与面向对象编程</a><ul><li><a href="#_8-1-理解对象">8.1 理解对象</a></li><li><a href="#_8-2-创建对象">8.2 创建对象</a></li><li><a href="#_8-3-继承">8.3 继承</a></li><li><a href="#_8-4-类">8.4 类</a></li><li><a href="#_8-5-小结">8.5 小结</a></li></ul></li><li><a href="#第9章-代理与反射">第9章 代理与反射</a></li><li><a href="#第10章-函数">第10章 函数</a><ul><li><a href="#_10-1箭头函数">10.1箭头函数</a></li><li><a href="#_10-2-函数名">10.2 函数名</a></li><li><a href="#_10-3-理解参数">10.3 理解参数</a></li><li><a href="#_10-4-没有重载">10.4 没有重载</a></li><li><a href="#_10-5-默认参数值">10.5 默认参数值</a></li><li><a href="#_10-6-参数扩展与收集">10.6 参数扩展与收集</a></li><li><a href="#_10-7-函数声明与函数表达式">10.7 函数声明与函数表达式</a></li><li><a href="#_10-8-函数作为值">10.8 函数作为值</a></li><li><a href="#_10-9-函数内部">10.9 函数内部</a></li><li><a href="#_10-10-函数属性与方法">10.10 函数属性与方法</a></li><li><a href="#_10-11-函数表达式">10.11 函数表达式</a></li><li><a href="#_10-12-递归">10.12 递归</a></li><li><a href="#_10-13-尾调用优化">10.13 尾调用优化</a></li><li><a href="#_10-14-闭包">10.14 闭包</a></li><li><a href="#_10-15-立即调用的函数表达式">10.15 立即调用的函数表达式</a></li><li><a href="#_10-16-私有变量">10.16 私有变量</a></li><li><a href="#_10-17-小结">10.17 小结</a></li></ul></li><li><a href="#第11章-期约与异步函数">第11章 期约与异步函数</a><ul><li><a href="#_11-1-异步编程">11.1 异步编程</a></li><li><a href="#_11-2-期约promise">11.2 期约Promise</a></li><li><a href="#_11-3-异步函数">11.3 异步函数</a></li><li><a href="#_11-4-小结">11.4 小结</a></li></ul></li><li><a href="#第12章-bom">第12章 BOM</a></li><li><a href="#第13章-客户端检测">第13章 客户端检测</a></li><li><a href="#第14章-dom">第14章 DOM</a></li><li><a href="#第15章-dom扩展">第15章 DOM扩展</a></li><li><a href="#第16章-dom2和dom3">第16章 DOM2和DOM3</a></li><li><a href="#第17章-事件">第17章 事件</a></li><li><a href="#第18章-动画与canvas图形">第18章 动画与Canvas图形</a></li><li><a href="#第19章-表单脚本">第19章 表单脚本</a></li><li><a href="#第20章-javascript-api">第20章 JavaScript API</a></li><li><a href="#第21章-错误处理与调试">第21章 错误处理与调试</a></li><li><a href="#第22章-处理xml">第22章 处理XML</a></li><li><a href="#第23章-json">第23章 JSON</a></li><li><a href="#第24章-网络请求与远程资源">第24章 网络请求与远程资源</a></li><li><a href="#第25章-客户端存储">第25章 客户端存储</a></li><li><a href="#第26章-模块">第26章 模块</a></li><li><a href="#第27章-工作者线程">第27章 工作者线程</a></li><li><a href="#第28章-最佳实践">第28章 最佳实践</a></li></ul></div><p></p> <h2 id="第1章-什么是javascript"><a href="#第1章-什么是javascript" class="header-anchor">#</a> 第1章 什么是JavaScript</h2> <h2 id="第2章-html中的javascript"><a href="#第2章-html中的javascript" class="header-anchor">#</a> 第2章 HTML中的JavaScript</h2> <h2 id="第3章-语法"><a href="#第3章-语法" class="header-anchor">#</a> 第3章 语法</h2> <h2 id="第4章-变量、作用域与内存"><a href="#第4章-变量、作用域与内存" class="header-anchor">#</a> 第4章 变量、作用域与内存</h2> <div class="custom-block tip"><p class="custom-block-title">本章内容</p> <ul><li>通过变量使用原始值与引用值</li> <li>理解执行上下文</li> <li>垃圾回收</li></ul></div> <p>正如ECMA-262所规定的，JavaScript变量是松散类型的，而且<strong>变量不过就是特定时间点一个特定值的名称而已</strong>。</p> <h3 id="_4-1-原始值与引用值"><a href="#_4-1-原始值与引用值" class="header-anchor">#</a> 4.1 原始值与引用值</h3> <p>ECMAScript变量可以包含两种不同类型的数据：原始值和引用值。<strong>原始值</strong>(primitive value)就是最简单的数据，<strong>引用值</strong>(reference value)则是由多个值构成的对象。</p> <p>在把一个值赋给变量时，JavaScript引擎必须确定这个值是原是指还是引用值。保存原始值的变量是**按值(by value)**访问的，因为我们操作的就是存储变量中的实际值。</p> <p>引用值是保存在内存中的对象。与其他语言不同，JavaScript不允许直接访问内存地址，因此也就不能直接操作对象所在的内存空间。在操作对象时，实际上操作的是对该对象的**引用（reference）<strong>而非实际的对象本身。为此，保存引用值的变量是</strong>按引用（by reference）**访问的。</p> <h4 id="_4-1-1-动态属性"><a href="#_4-1-1-动态属性" class="header-anchor">#</a> 4.1.1 动态属性</h4> <ul><li>原始值不能有属性，尽管尝试给原始值添加属性也不会报错。但是访问原始值的属性都会为<code>undefined</code>。</li> <li>只有引用值可以动态添加属性</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Nicholas'</span>
name<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">27</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>原始类型的初始化只使用原始字面量形式。即使使用了<code>new</code>关键字，则JavaScript会创建一个<code>Object</code>类型的实例，但是其行为类似于原始值。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'Matt'</span><span class="token punctuation">)</span>
name<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">26</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 26</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-1-2-复制值"><a href="#_4-1-2-复制值" class="header-anchor">#</a> 4.1.2 复制值</h4> <ul><li>在通过变量把一个原始值赋值到另一个变量时，原始值会被复制到新变量的位置。</li> <li>复制引用值的变量时，存储在变量中的值也会被复制到新变量所在的位置。区别在于，此时复制的值实际上是一个指针，它指向存储在内存中的对象。</li></ul> <h4 id="_4-1-3-传递参数"><a href="#_4-1-3-传递参数" class="header-anchor">#</a> 4.1.3 传递参数</h4> <ul><li><p>ECMAScript 中的所有函数的参数都是按值传递的。</p> <p>函数外的值会被复制到函数内部的参数中，就像从一个变量复制到另一个变量一样。</p> <p>如果是原始值，那么就跟原始值变量的复制一样，如果是引用值，那么就跟引用值变量的复制一样。</p></li> <li><p>在按值传递参数时，值会被复制到一个局部变量（即一个命名参数，或者按照ECMAScript的话说，就是<code>arguments</code>对象中的一个槽位）。在按引用传递参数时，值在内存中的位置会被保存在一个局部变量，这意味着对本地的修改会反应到函数外部。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addTen</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    num <span class="token operator">+=</span> <span class="token number">10</span>
    <span class="token keyword">return</span> num
<span class="token punctuation">}</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">addTen</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token comment">// 10 , 没有变化</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// 20</span>

<span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 当函数内部给 obj 设置了 name 属性时，函数外部的对象也会反映这个变化，因为 obj 指向的对象保存在全局作用域的堆内存上</span>
    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Nicholas'</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setName</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'Nicholas'</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>为了证明参数为对象时，仍是按值传递的，再举一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Nicholas'</span>
    obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Greg'</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setName</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'Nicholas'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>函数中参数的值改变之后，原始的引用仍然没变。当 obj 在函数内部被重写时，它变成了一个指向本地对象的指针。而那个本地对象在函数执行结束时就被销毁了。</p> <h4 id="_4-1-4-确定类型"><a href="#_4-1-4-确定类型" class="header-anchor">#</a> 4.1.4 确定类型</h4> <p>使用<code>typeof</code>来操作符最适合用来判断原始类型的数据。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>ECMA-262规定，任何实现内部 [[Call]] 方法的对象都应该在 typeof 检测时返回 &quot;function&quot; 。</p> <p>因为Chrome浏览器和Safari浏览器中的正则表达式实现了这个方法，所以 typeof 对正则表达式也返回 &quot;function&quot; 。在IE和Firef?x中， typeof 对正则表达式返回 &quot;object&quot; 。</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> u<span class="token punctuation">;</span>
<span class="token keyword">let</span> sb <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'string'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'number'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'boolean'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'undefined'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'symbol'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'function'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>使用 <code>instanceof</code>操作符来判断引用类型的数据，如果变量是给定引用类型（由其原型链决定，将在第8章?细介绍）的实例，则 instanceof 操作符返回 true 。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 具体语法如下</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> variable <span class="token keyword">instanceof</span> <span class="token class-name">constructor</span>

<span class="token comment">// 示例</span>
 <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> colors<span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
 <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/^\d{n}$/</span>
 <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">function</span> foo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> arg
 <span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colors <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reg <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>date <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// 所有其它的引用类型返回都为true, </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>colors <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reg <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>date <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>按照定义，所有引用值都是<code>Object</code>的实例，因此通过<code>instanceof</code>操作符检测任何引用值和<code>Object</code>构造函数都会返回<code>true</code>。</li> <li>如果用<code>instanceof</code>检测原始值，则始终会返回<code>false</code>，因为原始值都不是对象。</li></ul> <h3 id="_4-2-执行上下文与作用域"><a href="#_4-2-执行上下文与作用域" class="header-anchor">#</a> 4.2 执行上下文与作用域</h3> <p>JavaScript中有三种执行上下文类型：</p> <ul><li><strong>全局执行上下文——</strong> 这是默认或者说基础的上下文，任何不在函数内部的代码都在全局上下文中。它会执行两件事：创建一个全局的window对象（浏览器环境下），并设置<code>this</code>的值等于这个全局对象。一个程序中只会存在一个全局执行上下文。</li> <li><strong>函数执行上下文——</strong> 每当一个函数调用时，都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序执行一系列步骤。</li> <li><strong>Eval函数执行上下文——</strong> 执行在<code>eval</code>函数内部的代码也会有它属于自己的执行上下文，<code>eval</code>慎用，所以不做过多讨论。</li></ul> <h4 id="_4-2-1-作用域链增强"><a href="#_4-2-1-作用域链增强" class="header-anchor">#</a> 4.2.1 作用域链增强</h4> <ul><li><strong>try/catch语句的catch块——</strong> 会创建一个新的变量对象，这个变量对象会包含要抛出的错误对象的声明。</li> <li><strong>with语句——</strong> 会向作用域链前端添加指定的对象。</li></ul> <h4 id="_4-2-2-变量声明"><a href="#_4-2-2-变量声明" class="header-anchor">#</a> 4.2.2 变量声明</h4> <ul><li><p><strong>var ——</strong> 声明会被拿到函数或全局作用域的顶部，位于作用域中所有代码之前。这个现象叫作“提升”（hoisting）。</p> <p>如果存在函数声明和变量声明（注意：仅仅是声明，还没被赋值），而且变量与函数是同名的情况，函数的优先级更高一些。</p> <p>编译器询问作用域是否已经有同名的变量存在同一个作用域集合中，如果存在，编译器会忽略该声明；否则编译器会要求作用于在当前作用域集合中声明一个新的变量，并且命名。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  a <span class="token operator">=</span> <span class="token number">6</span>
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token comment">// 实际编译结果</span>
  <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">// a: function</span>
  <span class="token keyword">var</span> a 					<span class="token comment">// a: undefined</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>				    <span class="token comment">// 弹出 function</span>
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>					    <span class="token comment">// function a 执行：alert(10)	</span>
  a <span class="token operator">=</span> <span class="token number">3</span> 					<span class="token comment">// a: 3</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  a <span class="token operator">=</span> <span class="token number">6</span>					    <span class="token comment">// a:6</span>
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>						<span class="token comment">// typeError</span>
  
  <span class="token comment">// 最终执行结果</span>
  <span class="token comment">// 'function a(){ alert(10) }'</span>
  <span class="token comment">// 10</span>
  <span class="token comment">// 3</span>
  <span class="token comment">// typeError: a is not a function</span>
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li><strong>let——</strong> 在同一作用域内不能声明多次。重复的 <code>var</code> 声明会被忽略，而重复的 <code>let</code>声明会抛出
<code>SyntaxError</code> 错误。</li></ul> <p>严格来讲，<code>let</code>在JavaScript运行中会被提升，但是由于“暂时性死区”的缘故，实际上不能在声明之前使用<code>let</code>变量。因此，从写JavaScript代码的角度说，<code>let</code>的提升跟<code>var</code>是不一样的。</p> <ul><li><strong>const——</strong> 使用 const 声明的变量必须同时初始化为某个值。一经声明，在其生命周期的
任何时候都不能再重新赋予新值，但对象的键（属性）则不受限制。
如果想让整个对象不可修改，可以使用<code>Object.freeze()</code>，这样再给属性值赋值时虽然不会报错，但是会静默失败。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> o <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
o<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Kyle'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>由于<code>const</code>声明暗示变量的值是单一类型且不可修改的，编译器可以将所有的实例替换成实际值，而不会通过查询表进行变量查找。谷歌V8引擎就执行这种优化。</strong></p> <ul><li><strong>标识符查找——</strong> 访问局部变量比访问全局变量要快，因为不用切换作用域。</li></ul> <p>如果局部上下文中有一个同名的标识符，那就不能在该上下文中引用父级上下文中的同名标识符，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token string">'blue'</span>
<span class="token keyword">function</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token string">'red'</span>
	<span class="token keyword">return</span> color
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// red</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-3-垃圾回收"><a href="#_4-3-垃圾回收" class="header-anchor">#</a> 4.3 垃圾回收</h3> <p>JavaScript是使用垃圾回收的语言，也就是说执行环境负责在代码执行时管理内存。通过自动内存管理实现内存分配和闲置资源回收：确定哪个变量不会再使用，然后释放它占用的内存。这个过程是周期性的，即垃圾回收程序每隔一定时间（或者说在代码执行过程中某个预定的收集时间）就会自动执行。</p> <h4 id="_4-3-1-标记清理"><a href="#_4-3-1-标记清理" class="header-anchor">#</a> 4.3.1 标记清理</h4> <p>垃圾回收程序运行的时候，会标记内存中储存的所有变量（记住，标记方法有很多种）。然后它会将所有在上下文中的变量，以及被在上下文中的变量引用的变量的标记去掉。在此之后再被加上标记的变量就是待删除的了，原因是任何在上下文中的变量都访问不到它们了。随后垃圾回收程序做一次<strong>内存清理</strong>，销毁带标记的所有值并收回它们的内存。</p> <p>2008年后，几乎所有不同浏览器都采用标记清理策略，只是垃圾回收的频率有所差异。</p> <h4 id="_4-3-2-引用计数"><a href="#_4-3-2-引用计数" class="header-anchor">#</a> 4.3.2 引用计数</h4> <p>另一种垃圾回收策略引用计数，其思路就是对每个值都记录它被引用的次数。</p> <ul><li>声明变量并且给它赋一个引用值时，这个值的引用数为1。</li> <li>如果同一个值又被赋给另一个变量，那么引用次数加1。</li> <li>如果保存该值的引用的变量被其它值给覆盖了，那么引用数减1。</li> <li>当一个值的引用次数为0时，说明无法再访问这个值了，因此就可以安全地回收其内存了。</li></ul> <p>引用计数容易遇到一个严重的问题：循环引用（套娃）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">problem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> objA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> objB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  objA<span class="token punctuation">.</span>a <span class="token operator">=</span> objB
  ObjB<span class="token punctuation">.</span>b <span class="token operator">=</span> objA
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-3-3-性能"><a href="#_4-3-3-性能" class="header-anchor">#</a> 4.3.3 性能</h4> <p>无论什么时候开始收集垃圾，都能让它尽快结束工作。</p> <p>现代浏览器回收程序基本上都是根据已分配对象的大小和数量来判断的。根据V8团队2016年的一篇博文的说法：“在一次完整的垃圾回收之后，V8的堆增长策略会根据活跃对象的数量外加一些余量来确定何时再次进行垃圾回收”</p> <p>IE固定的内存分配数的策略，256个变量、4096个对象/数组或64kb字符串都会触发其垃圾回收程序。这样做很可能导致垃圾回收程序过于频繁，严重影响性能。这个问题一直到IE7才解决。</p> <h4 id="_4-3-4-内存管理"><a href="#_4-3-4-内存管理" class="header-anchor">#</a> 4.3.4 内存管理</h4> <p>出于安全考虑，系统中浏览器被分配到的内存往往比桌面软件要少的多，原因是避免运行大量JavaScript的网页耗尽系统内存而导致操作系统崩溃。</p> <ul><li>优化内存的最佳手段就是保证在执行代码时只保存必要的数据，如果数据不再必要，则将它设置为<code>null</code></li> <li>使用<code>const</code>和<code>let</code>，因为这两个声明符都是以块而非函数为作用域。</li> <li>尽量避免对象进行动态属性的增删，建议将要添加的属性先显示定义，或者在将要删除的属性值设置为<code>null</code></li> <li>内存泄漏容易常见于全局变量、定时器以及闭包等几个场景。</li> <li>使用对象池和静态分配的手段是一种相对极端的优化方式，需要权衡。</li></ul> <h3 id="_4-4-小结"><a href="#_4-4-小结" class="header-anchor">#</a> 4.4 小结</h3> <ul><li><p><strong>JavaScript 变量可以保存两种类型的值：原始值和引用值。原始值类型包含6种：<code>Undefined</code>、<code>Null</code>、<code>Boolean</code>、<code>Number</code>、<code>String</code>和<code>Symbol</code>。</strong></p> <ul><li>原始值大小固定，因此保存在<strong>栈内存</strong>上</li> <li>从一个变量到另一个变量复制原始值会创建该值的第二个副本。</li> <li>引用值是对象，存储在<strong>堆内存</strong>上。</li> <li>包含引用值的变量实际上只包含指向相应对象的一个指针地址，而不是对象本身。</li> <li>从一个变量到另一个变量复制引用值只会复制指针，因此结果是两个变量都指向同一个对象。</li> <li><code>typeof</code>操作符可以确定值的原始类型，而<code>instanceof</code>操作符用于确保值的引用类型。</li></ul></li> <li><p><strong>任何变量（不论是原始值还是引用值）都存在于某个执行上下文中（也称为作用域）。这个上下文决定了变量的生命周期，以及它们可以访问代码的哪些部分。</strong></p> <ul><li>执行上下文分为全局上下文、函数上下文和块级上下文。</li> <li>代码执行流每进入一个新的上下文，都会创建一个作用域链，用于搜索变量和函数。</li> <li>函数或块的局部上下文不仅可以访问自己作用于内的变量，也可以访问任何包含（父级）上下文乃至全局上下文中的变量。</li> <li>全局上下文只能访问全局上下文中的变量和函数，不能直接访问局部上下文中的任何数据。</li> <li>变量的执行上下文用于确定什么时候释放内存。</li></ul></li> <li><p><strong>JavaScript是使用垃圾回收的编程语言，开发者不需要操心内存分配和回收。</strong></p> <ul><li>离开作用域的值会被自动标记为可回收，然后 在垃圾回收期间被删除。</li> <li>主流的垃圾回收算法是标记清理，即先给当前不使用的值加上标记，再回来回收它们的内存。</li> <li>引用计数是另一种垃圾回收策略，需要记录值被引用了多少此。JavaScript引擎不再使用这种算法，但是某些旧版本IE仍会受这种算法影响，原因是JavaScript会访问非原生JavaScript对象（如DOM元素）。</li> <li>引用计数在代码中存在循环引用时会出现的问题。</li> <li>解除变量的引用不仅可以消除循环引用，而且对垃圾回收也有帮助。为促进内存回收，全局对象及其属性和循环引用都应该在不需要时解除引用。</li></ul></li></ul> <h2 id="第5章-基本引用类型"><a href="#第5章-基本引用类型" class="header-anchor">#</a> 第5章 基本引用类型</h2> <h2 id="第6章-集合引用类型"><a href="#第6章-集合引用类型" class="header-anchor">#</a> 第6章 集合引用类型</h2> <h2 id="第7章-迭代器与生成器"><a href="#第7章-迭代器与生成器" class="header-anchor">#</a> 第7章 迭代器与生成器</h2> <h2 id="第8章-对象、类与面向对象编程"><a href="#第8章-对象、类与面向对象编程" class="header-anchor">#</a> 第8章 对象、类与面向对象编程</h2> <h3 id="_8-1-理解对象"><a href="#_8-1-理解对象" class="header-anchor">#</a> 8.1 理解对象</h3> <h3 id="_8-2-创建对象"><a href="#_8-2-创建对象" class="header-anchor">#</a> 8.2 创建对象</h3> <h3 id="_8-3-继承"><a href="#_8-3-继承" class="header-anchor">#</a> 8.3 继承</h3> <h3 id="_8-4-类"><a href="#_8-4-类" class="header-anchor">#</a> 8.4 类</h3> <h3 id="_8-5-小结"><a href="#_8-5-小结" class="header-anchor">#</a> 8.5 小结</h3> <h2 id="第9章-代理与反射"><a href="#第9章-代理与反射" class="header-anchor">#</a> 第9章 代理与反射</h2> <h2 id="第10章-函数"><a href="#第10章-函数" class="header-anchor">#</a> 第10章 函数</h2> <div class="custom-block tip"><p class="custom-block-title">本章内容</p> <ul><li>函数表达式、函数声明及箭头函数</li> <li>默认参数及扩展操作符</li> <li>使用函数实现递归</li> <li>使用闭包实现私有变量</li></ul></div> <p>函数实际上也是个对象。每个函数都是<code>Function</code>类型的实例，而<code>Function</code>也有属性和方法，跟其它引用类型一样。<strong>函数名就是指向函数对象的指针，而且不一定与函数本身紧密绑定。</strong></p> <p><strong>函数的定义：</strong></p> <ul><li>使用<code>function</code>关键字定义</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span> <span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>使用变量名定义一个匿名函数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>使用<code>Function</code>构造函数定义**（不推荐）**</li></ul> <blockquote><p>不推荐使用构造函数这种语法来定义函数，因为这段代码会被解释执行两次：第一次是将它当作常规ECMAScript代码，第二次是解释传给构造函数的字符串。这显然会影响性能。不过，把函数想象成对象，把函数名称想象成指针是很重要的。而上面这种语法很好的诠释了这些概念。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;num1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;num2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;return  num1 + num2&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_10-1箭头函数"><a href="#_10-1箭头函数" class="header-anchor">#</a> 10.1箭头函数</h3> <ul><li>使用箭头函数实例化的函数对象与“正式的”函数表达式创建的函数对象行为是相同的。任何可以使用函数表达式的地方，都可以使用箭头函数；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">arrowSum</span> <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token parameter">a<span class="token punctuation">,</span>  b</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> a <span class="token operator">+</span>b
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">functionExpressionSum</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">arrowSum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 13</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">functionExpressionSum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 13</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>箭头函数简洁的衣服啊非常适合嵌入函数的场景。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> ints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ints<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [2, 3, 4]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ints<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> i <span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [2, 3, 4]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果只有一个参数，那也可以不用括号。只有没有参数，或者多个参数的情况下，才需要使用括号。</p> <p><strong>箭头函数虽然语法简洁，但也有很多场景不适用。</strong></p> <ul><li>箭头函数不能使用<code>arguments</code>、<code>super</code>、和<code>new.target</code>；</li> <li>不能用做构造函数；</li> <li>没有<code>prototype</code>属性。</li></ul> <h3 id="_10-2-函数名"><a href="#_10-2-函数名" class="header-anchor">#</a> 10.2 函数名</h3> <p>因为函数名就是指向函数的指针，所以它们跟其他包含对象指针的变量具有相同的行为。这意味着一个函数可以有多个名称，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span> <span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 20</span>

<span class="token keyword">let</span> anotherSum <span class="token operator">=</span> sum
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">anotherSum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 20</span>

sum <span class="token operator">=</span> <span class="token keyword">null</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">anotherSum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>所有的函数对象都会暴露一个<strong>只读的</strong><code>name</code>属性，其中包含关于函数的信息。多数情况下，这个属性中保存的就是一个函数标识符，或者说是一个字符串化的变量名。即使函数没有名称，也会如实显示成空字符串。如果是使用<code>Function</code>构造函数创建的，则会表示成&quot;<code>anonymous</code>&quot;。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">baz</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'foo'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'bar'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baz<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'baz' </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// ''</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'anonymous'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果函数是一个获取函数、设置函数，或者使用<code>bind()</code>实例化，那么标识符前面会加上一个前缀：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'bound foo'</span>

<span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token punctuation">{</span>
    years<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>years
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token parameter">newAge</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>years <span class="token operator">=</span> newAge
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> propertyDescriptor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>dog<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propertyDescriptor<span class="token operator">?.</span>get<span class="token operator">?.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'get age'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>propertyDescriptor<span class="token operator">?.</span>set<span class="token operator">?.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'set age'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_10-3-理解参数"><a href="#_10-3-理解参数" class="header-anchor">#</a> 10.3 理解参数</h3> <p>ECMAScript函数的参数在内部表现为一个类数组对象（非Array的实例）。函数被调用时总会接收一个数组，但是函数本身并不关心数组中包含了什么。在使用<code>function</code>关键字定义（非箭头）函数时，可以在函数内部访问<code>arguments</code>对象，从中取得传进来的每个参数值。</p> <p><code>arguments</code>可以使用下标索引来访问（<code>arguments[0]</code>、<code>arguments[1]</code>），使用<code>arguments.length</code>来访问参数的数量。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// undefined, undefined , 0</span>
<span class="token function">howManyArgs</span><span class="token punctuation">(</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span> <span class="token comment">// 'string', 45 , 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>aguments</code>对象可以与形参一起使用，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num1 <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> num2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在<strong>非严格模式</strong>下，<code>aguments</code>对象的值始终会与对应的参数同步，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> num2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 30</span>
<span class="token function">doAdd</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>num2</code> 和<code>arguments[1]</code>的内存地址并不一样，只不过会保持同步而已；</li> <li>修改形参<code>num2</code>不会影响<code>arguments[1]</code>对象中相应的值；</li> <li>如果没有显式的传入形参，通过设置<code>arguments[1]</code>索引设置并不会映射到第二个形参上，因为<code>arguments</code>对象的长度是<strong>根据调用函数时传入的参数个数，而非定义函数时给出的命名参数个数确定的</strong>；</li> <li>严格模式下，重写<code>arguments</code>对象会导致语法错误。</li></ul> <p>箭头函数内访问内<code>arguments</code>关键字会报错，但是可以访问其包装函数的<code>arguments</code>对象，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arugments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">// ReferenceError: arugments is not defined</span>


<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arugments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_10-4-没有重载"><a href="#_10-4-没有重载" class="header-anchor">#</a> 10.4 没有重载</h3> <p>因为ECMAScirpt函数的参数是由包含零个或多个值表示的。没有函数签名，自然也没有重载。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 相当于</span>
<span class="token keyword">let</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_10-5-默认参数值"><a href="#_10-5-默认参数值" class="header-anchor">#</a> 10.5 默认参数值</h3> <p>在ECMAScript5.1及之前，实现默认参数的一种常用方式就是检测某个参数是否等于<code>undefined</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    neme <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token operator">?</span> name <span class="token operator">:</span> <span class="token string">'Kyle'</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> VIII</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'King Henry VIII'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'King Louis VIII'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在ECMAScript6之后支持显式定义默认参数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">makeKing</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'Henry'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">King </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> VIII</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'King Henry VIII'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">makeKing</span><span class="token punctuation">(</span><span class="token string">'Louis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'King Louis VIII'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_10-6-参数扩展与收集"><a href="#_10-6-参数扩展与收集" class="header-anchor">#</a> 10.6 参数扩展与收集</h3> <h3 id="_10-7-函数声明与函数表达式"><a href="#_10-7-函数声明与函数表达式" class="header-anchor">#</a> 10.7 函数声明与函数表达式</h3> <h3 id="_10-8-函数作为值"><a href="#_10-8-函数作为值" class="header-anchor">#</a> 10.8 函数作为值</h3> <h3 id="_10-9-函数内部"><a href="#_10-9-函数内部" class="header-anchor">#</a> 10.9 函数内部</h3> <h3 id="_10-10-函数属性与方法"><a href="#_10-10-函数属性与方法" class="header-anchor">#</a> 10.10 函数属性与方法</h3> <h3 id="_10-11-函数表达式"><a href="#_10-11-函数表达式" class="header-anchor">#</a> 10.11 函数表达式</h3> <h3 id="_10-12-递归"><a href="#_10-12-递归" class="header-anchor">#</a> 10.12 递归</h3> <h3 id="_10-13-尾调用优化"><a href="#_10-13-尾调用优化" class="header-anchor">#</a> 10.13 尾调用优化</h3> <h3 id="_10-14-闭包"><a href="#_10-14-闭包" class="header-anchor">#</a> 10.14 闭包</h3> <h3 id="_10-15-立即调用的函数表达式"><a href="#_10-15-立即调用的函数表达式" class="header-anchor">#</a> 10.15 立即调用的函数表达式</h3> <h3 id="_10-16-私有变量"><a href="#_10-16-私有变量" class="header-anchor">#</a> 10.16 私有变量</h3> <h3 id="_10-17-小结"><a href="#_10-17-小结" class="header-anchor">#</a> 10.17 小结</h3> <h2 id="第11章-期约与异步函数"><a href="#第11章-期约与异步函数" class="header-anchor">#</a> 第11章 期约与异步函数</h2> <div class="custom-block tip"><p class="custom-block-title">本章内容</p> <ul><li>异步编程</li> <li>期约</li> <li>异步函数</li></ul></div> <h3 id="_11-1-异步编程"><a href="#_11-1-异步编程" class="header-anchor">#</a> 11.1 异步编程</h3> <p>同步行为和异步行为的对立统一是计算机科学的一个基本概念。特别是JavaScript这种单线程事件循环模型中，同步操作与异步操作更是代码索要依赖的核心机制。异步行为是为了优化因计算量大而时间长的操作。如果在等待其他操作完成的同时，即使运行其他指令，系统也能保持稳定，那么这样做就是务实的。</p> <p>重要的是，异步操作并不一定计算量大或要等很长时间。只要你不想为等待某个异步操作而阻塞线程执行，那么任何时候都可以使用。</p> <h4 id="_11-1-1-同步与异步"><a href="#_11-1-1-同步与异步" class="header-anchor">#</a> 11.1.1 同步与异步</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// sync</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span>
x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">4</span>

<span class="token comment">// async </span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>同步行为</strong>对应内存中顺序执行的处理器命令。在程序执行的每一步，都可以推断出程序的状态。这是因为后面的指令总是在前面的指令完成后才会执行。</li> <li><strong>异步行为</strong>类似于系统中断，即当前进程外部的实体可以触发代码执行。异步代码不容易推断。</li></ul> <p>虽然例子中的两个结果没有什么区别，但是第二个指令块（加操作和赋值操作）是由定时器触发的，这会生成一个入队执行的中断。到底什么时候触发这个中断，这对JavaScript运行时来说是一个黑盒，因此实际上无法预知。</p> <h4 id="_11-1-2-以往的异步编程模式"><a href="#_11-1-2-以往的异步编程模式" class="header-anchor">#</a> 11.1.2 以往的异步编程模式</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 给异步操作提供相应成功和失败的处理回调</span>
<span class="token keyword">function</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> success<span class="token punctuation">,</span> failure</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token string">'Must provide number as first argument'</span>
            <span class="token punctuation">}</span>
            <span class="token function">success</span><span class="token punctuation">(</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">failure</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这种模式已经不可取了，因为必须在初始化异步操作时定义回调。异步函数的返回值只在短时间内存在，只有预备好将这个短时间内存在的值作为参数的回调才能接收到它。</p> <p>如果异步返回值又依赖另一个异步返回值，很容易造成嵌套回调，随着代码越来越复杂，回调策略是不具有扩展性的。<mark><strong>回调地狱</strong></mark>这个称呼由此产生的。</p> <h3 id="_11-2-期约promise"><a href="#_11-2-期约promise" class="header-anchor">#</a> 11.2 期约Promise</h3> <ul><li><code>promise</code>这个名字最早是又Daniel Friedman 和 David Wise在他们1976年论文《The Impact of Applicative Programming on Multiprocessing（应用程序设计编程对多处理的影响）》中提出来的。</li> <li>Barbara Liskov 和 Liuba Shrira 在1988年发表论文，这个概念才真正确立下来。</li> <li>同一时期，类似的概念术语还有&quot;终局(eventual)&quot;、&quot;期许(future)&quot;、&quot;终局(delay)&quot;和&quot;终局(deferred)&quot;等，它们都是描述一种异步程序执行的机制。</li></ul> <h4 id="_11-2-1-promise-a-规范"><a href="#_11-2-1-promise-a-规范" class="header-anchor">#</a> 11.2.1 Promise/A+规范</h4> <ul><li>早期的期约机制在<code>jQuery</code>和<code>Dojo</code>中以<code>Deferred API</code>形式出现的。</li> <li>2010年，CommonJS项目实现的Promise/A规范</li> <li>2012年，Promise/A+组织fork了CommonJS的Promise/A建议，并制定了Promise/A+规范。最终成为ECMAScript规范实现的范本。</li></ul> <p><a href="https://www.css88.com/jqapi-1.9/category/deferred-object/" target="_blank" rel="noopener noreferrer">jQuery中的<code>Deferred对象</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="_11-2-2-期约基础"><a href="#_11-2-2-期约基础" class="header-anchor">#</a> 11.2.2 期约基础</h4> <ul><li>期约状态机</li></ul> <p>期约是一个有状态的对象，可能处于如下3种状态之一：</p> <ol><li><strong>待定</strong>（pending）</li> <li><strong>兑现</strong>（fulfilled或resolved）</li> <li><strong>拒绝</strong>（rejected）</li></ol> <p>待定（pending）是期约的最初状态。期约可以落定（settled）为代表成功的兑现（fulfilled）状态，或是代表失败的拒绝（rejected）状态。<strong>无论落定哪个状态都是 不可逆的</strong>。</p> <p>期约的状态是私有的，不能通过外部JavaScript代码修改。这主要是为了避免根据读到的期约状态，以同步方式处理期约对象。</p> <ul><li>解决值、拒绝理由和期约用例</li></ul> <p>期约主要是抽象地表示一个异步操作，它会实际的产生某个值，而程序期待期约状态改变时可以访问这个值。每个期约只要状态切换为“兑现”，就会有一个私有的内部值（result），类似的，切换为拒绝（rejected）时 ，会有一个私有的内部理由(reason)。<strong>无论是值还是理由，都是包含原始值或对象的不可修改的引用</strong>。二者是可选的，而且默认值都为<code>undefined</code>。在期约到达某个落定状态执行的异步代码始终会收到这个值或理由。</p> <ul><li>通过执行函数控制期约状态</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'executor'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> <span class="token string">'promise initialized'</span><span class="token punctuation">)</span>
<span class="token comment">// 'executor'</span>
<span class="token comment">// 'promise initialized'</span>


<span class="token comment">// 添加setTimeout推迟切换状态</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 在console.log打印期约的时候，还不会执行reolve()</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Promise {&lt;fulfilled&gt;: undefined}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Promise {&lt;rejected&gt;: undefined}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>无论<code>resolve()</code>和<code>reject()</code>中的哪个被调用，状态转换都不可撤销了。于是继续修改状态会静默失败。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 没有效果</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Promise.resolve()/Promise.reject()</li></ul> <ol><li><p>通过调用<code>Promise.resolve()</code>静态方法，可以实例化一个解决的期约。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">// 下面两个实例实际是一样的</span>
 <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>只接收一个参数，剩余的参数会被忽略</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Promise {&lt;fulfilled&gt;: 4}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>如果参数本身是一个期约，那它的行为就类似于一个空包装。因此,Promise.resolve()可以说是一个幂等方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p <span class="token operator">===</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p <span class="token operator">===</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>最好将预期值放入对应它的静态方法不要将兑现值放入Promise.resolve()，错误对象等非预期的值放入Promise.reject()。</p></li> <li><p>Promise的设计很大程度上会导致一种完全不同于JavaScript的计算模式。因为这里没有通过异步模式捕获错误。期约本身是同步对象，但也是异步执行模式的媒介。下面的例子中，拒绝期约的错误并没有抛到同步代码的线程里，而是进入浏览器异步消息队列里处理的。因此，<code>try/catch</code>块并不能捕获该错误。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token comment">// Error: 'foo'</span>
<span class="token punctuation">}</span>


<span class="token keyword">try</span><span class="token punctuation">{</span>
    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token comment">// 不会执行</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol> <h4 id="_11-2-3-期约的实例方法"><a href="#_11-2-3-期约的实例方法" class="header-anchor">#</a> 11.2.3 期约的实例方法</h4> <p>期约实例的方法是连接外部同步代码与内部异步代码之间的桥梁。执行方法可以访问异步操作返回的数据，处理期约成功和失败的结果，连续对期约求值，或者添加只有期约进入终止状态时才会执行的代码。</p> <ul><li><p>实现Thenable接口</p></li> <li><p>Promise.prototype.then()</p> <ul><li>接收两个参数<code>onResolved</code>和<code>onRejected</code>处理程序，分别对于“兑现”和“拒绝”状态时执行。</li> <li><code>onResolved</code>和<code>onRejected</code>两个操作是互斥的。</li> <li>任何传入<code>then()</code>方法的非函数类型的参数都会被静默忽略。</li> <li>它会返回一个新的期约实例</li> <li>如果没有显示的返回语句，则<code>Promise.then()</code>会包装默认的返回值<code>undefined</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 不推荐， 非函数处理程序会被默认忽略</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token string">'gobbeltygook'</span><span class="token punctuation">)</span>

<span class="token comment">// 推荐写法</span>
p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>

<span class="token comment">// 若调用then()时不传处理程序，则会原样向后传，虽然这样做并没什么意义</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>p2<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;resolved&gt; : 'foo'</span>

<span class="token comment">// 以下几个结果都一样</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p4 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p5 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>p3<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;resolved&gt; : undefined</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>p4<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;resolved&gt; : undefined</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>p5<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;resolved&gt; : undefined</span>

<span class="token comment">// 以下几个结果都一样</span>
<span class="token keyword">let</span> p6 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'bar'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p7 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>p3<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;resolved&gt; : 'bar'</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span>p4<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;resolved&gt; : 'bar'</span>

<span class="token comment">// Promise.resolve()保留返回的期约</span>
<span class="token keyword">let</span> p8 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promsise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p9 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// Uncauht (in promise): undefined</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p8<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;pending&gt;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p9<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;rejected&gt; : undefined</span>

<span class="token comment">// 抛出异常则会返回拒绝的期约</span>
<span class="token keyword">let</span> p10 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string">'baz'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Uncauht (in promise): undefined</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p9<span class="token punctuation">)</span> <span class="token comment">// Promise&lt;rejected&gt; : 'baz'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></li> <li><p>Promise.prototype.catch()</p> <p>该方法用于给期约添加拒绝处理程序。它只接收一个参数：<code>onRejected</code>函数。事实上，这个方法就是一个语法糖，调用它就相当于调用了<code>Promise.prototype.then(null, onRejected)</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 下面两个用例结果是一样的</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span> <span class="token comment">// rejected</span>
p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>      <span class="token comment">// rejected</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>Promise.prototype.finally(）</p> <ul><li>这个方法在期约转换为解决或拒绝状态时执行，避免在<code>onResolved</code>和<code>onRejected</code>处理程序中出现冗余代码。</li> <li>与状态无关，大多数情况下表现为对父期约的传递。</li></ul></li> <li><p>非重入期约的方法</p></li></ul> <h4 id="_11-2-4-期约连锁"><a href="#_11-2-4-期约连锁" class="header-anchor">#</a> 11.2.4 期约连锁</h4> <h4 id="_11-2-4-期约扩展"><a href="#_11-2-4-期约扩展" class="header-anchor">#</a> 11.2.4 期约扩展</h4> <h3 id="_11-3-异步函数"><a href="#_11-3-异步函数" class="header-anchor">#</a> 11.3 异步函数</h3> <h3 id="_11-4-小结"><a href="#_11-4-小结" class="header-anchor">#</a> 11.4 小结</h3> <h2 id="第12章-bom"><a href="#第12章-bom" class="header-anchor">#</a> 第12章 BOM</h2> <h2 id="第13章-客户端检测"><a href="#第13章-客户端检测" class="header-anchor">#</a> 第13章 客户端检测</h2> <h2 id="第14章-dom"><a href="#第14章-dom" class="header-anchor">#</a> 第14章 DOM</h2> <h2 id="第15章-dom扩展"><a href="#第15章-dom扩展" class="header-anchor">#</a> 第15章 DOM扩展</h2> <h2 id="第16章-dom2和dom3"><a href="#第16章-dom2和dom3" class="header-anchor">#</a> 第16章 DOM2和DOM3</h2> <h2 id="第17章-事件"><a href="#第17章-事件" class="header-anchor">#</a> 第17章 事件</h2> <h2 id="第18章-动画与canvas图形"><a href="#第18章-动画与canvas图形" class="header-anchor">#</a> 第18章 动画与Canvas图形</h2> <h2 id="第19章-表单脚本"><a href="#第19章-表单脚本" class="header-anchor">#</a> 第19章 表单脚本</h2> <h2 id="第20章-javascript-api"><a href="#第20章-javascript-api" class="header-anchor">#</a> 第20章 JavaScript API</h2> <h2 id="第21章-错误处理与调试"><a href="#第21章-错误处理与调试" class="header-anchor">#</a> 第21章 错误处理与调试</h2> <h2 id="第22章-处理xml"><a href="#第22章-处理xml" class="header-anchor">#</a> 第22章 处理XML</h2> <h2 id="第23章-json"><a href="#第23章-json" class="header-anchor">#</a> 第23章 JSON</h2> <h2 id="第24章-网络请求与远程资源"><a href="#第24章-网络请求与远程资源" class="header-anchor">#</a> 第24章 网络请求与远程资源</h2> <h2 id="第25章-客户端存储"><a href="#第25章-客户端存储" class="header-anchor">#</a> 第25章 客户端存储</h2> <h2 id="第26章-模块"><a href="#第26章-模块" class="header-anchor">#</a> 第26章 模块</h2> <h2 id="第27章-工作者线程"><a href="#第27章-工作者线程" class="header-anchor">#</a> 第27章 工作者线程</h2> <h2 id="第28章-最佳实践"><a href="#第28章-最佳实践" class="header-anchor">#</a> 第28章 最佳实践</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">11/27/2020, 5:42:30 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ad74b50b.js" defer></script><script src="/assets/js/2.2054c3ab.js" defer></script><script src="/assets/js/22.afbc471c.js" defer></script>
  </body>
</html>
